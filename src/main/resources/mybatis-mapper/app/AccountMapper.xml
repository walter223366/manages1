<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.ral.manages.mapper.app.IAccountMapper">

    <sql id="accountResult">
        id,account,source,tellphone,DATE_FORMAT(lrrq,'%Y-%m-%d %H:%i:%s') as lrrq,cancellation,deleteStatus
    </sql>
    <sql id="conditionalCheck">
        <if test="account != null and account != ''">
          AND account like '%${account}%'
        </if>
        <if test="tellPhone != null and tellPhone != ''">
          AND tellphone like '%${tellPhone}%'
        </if>
        <if test="source != null and source != ''">
          AND source=#{source}
        </if>
        <if test="startTime != null and startTime != ''">
          AND DATE_FORMAT(lrrq,'%Y-%m-%d') <![CDATA[>=]]> DATE_FORMAT(#{startTime},'%Y-%m-%d')
        </if>
        <if test="endTime != null and endTime != ''">
          AND DATE_FORMAT(lrrq,'%Y-%m-%d') <![CDATA[<=]]> DATE_FORMAT(#{endTime},'%Y-%m-%d')
        </if>
    </sql>


    <!--查询-->
    <select id="accountPagingQuery" parameterType="map" resultType="map">
        SELECT  <include refid="accountResult"/>  FROM biz_user WHERE 1=1  <include refid="conditionalCheck"/>  AND (deleteStatus IS NULL OR deleteStatus=0) ORDER BY lrrq DESC
    </select>
    <select id="accountIsExist" parameterType="com.ral.manages.entity.app.Account" resultType="int">
        SELECT COUNT(1) FROM biz_user WHERE 1=1 AND id=#{account.id}
    </select>
    <select id="accountIsName" parameterType="com.ral.manages.entity.app.Account" resultType="int">
        SELECT COUNT(1) FROM biz_user WHERE 1=1 AND name=#{account.name}
    </select>
    <select id="accountEditQuery" parameterType="com.ral.manages.entity.app.Account" resultType="map">
        SELECT  <include refid="accountResult"/>  FROM  biz_user WHERE 1=1 AND (id=#{account.id} OR account=#{account.account})
    </select>


    <!--新增-->
    <insert id="accountInsert" parameterType="com.ral.manages.entity.app.Account">
        INSERT INTO biz_user(id,account,password,source,tellphone,lrrq,cancellation,deleteStatus)
        VALUES (#{account.id},#{account.account},#{account.password},#{account.source},#{account.tellphone},#{account.lrrq},#{account.cancellation},#{account.deleteStatus})
    </insert>


    <!--修改-->
    <update id="accountUpdate" parameterType="com.ral.manages.entity.app.Account">
        UPDATE biz_user SET tellphone=#{account.tellphone},account=#{account.account},source=#{account.source} WHERE 1=1 AND id=#{account.id}
    </update>


    <!--删除-->
    <update id="accountDelete" parameterType="com.ral.manages.entity.app.Account">
        UPDATE biz_user SET deleteStatus=#{account.deleteStatus} WHERE 1=1 AND id=#{account.id}
    </update>
    <update id="accountBatchDelete" parameterType="map">
        UPDATE biz_user SET deleteStatus=#{deleteStatus} WHERE 1=1 AND id=#{id}
    </update>

</mapper>